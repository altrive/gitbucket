version: '{build}'
image: Visual Studio 2017
services:
  - mssql2016
# - postgresql
# - mysql
environment:
  global:
    TEST_DBMS_SQLServer: true
branches:
  except: 
    - gh-pages
install:
  - ps: |
      (get-psprovider 'FileSystem').Home = 'c:\projects\'
      iex (new-object net.webclient).downloadstring('https://get.scoop.sh')
      scoop update
      scoop install -y ant
      scoop install -y scala
      scoop install -y sbt
      # Followin software are installed by default <https://www.appveyor.com/docs/build-environment/#pre-installed-software>
      # - JDK8
      # - Maven
  - cmd: |
      SET JAVA_HOME=C:\Program Files\Java\jdk1.8.0
      SET PATH=%JAVA_HOME%\bin;%PATH%
      SET 
build_script:
  - sbt clean compile
on_success:
  - sbt executable
test_script:
  - sbt test
after_test:
  - ps: |
      $url = "https://ci.appveyor.com/api/testresults/junit/$($env:APPVEYOR_JOB_ID)"
      $files = Get-ChildItem '.\target\test-reports\TEST-*.xml'
      foreach ($file in $files) {
          (New-Object 'System.Net.WebClient').UploadFile($url, (Resolve-Path $file))
      }
cache:
  - "%LocalAppData%\scoop"  -> appveyor.yml
  - "%USERPROFILE%\.m2"     -> appveyor.yml
  - "%USERPROFILE%\.ivy2""  -> appveyor.yml
artifacts:
  - path: 'target\executable\gitbucket.war'
  - path: 'target\executable\gitbucket.md5'
  - path: 'target\executable\gitbucket.sha1'
  - path: 'target\executable\gitbucket.sha256'
